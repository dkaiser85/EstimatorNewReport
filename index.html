<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Culture MRI® Profit Estimator</title>
    <!-- Import Inter Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Viewport Meta Tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Profit Calc">
    <meta name="theme-color" content="#6666CC">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/CMRI192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icons/CMRI512.png">
    <link rel="apple-touch-icon" href="./icons/CMRI192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="./icons/CMRI192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="./icons/CMRI512.png">
    <style>
        /* Add/modify these styles */
        html, body {
            max-width: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: transparent;
            padding: 10px;
            box-sizing: border-box;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        /* Container Styling */
        .calculator-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            background-color: transparent;
            box-shadow: none;
            box-sizing: border-box;
        }

        /* Header Styling */
        .calculator-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .calculator-header h2 {
            font-size: 28px;
            font-weight: 700; /* Inter Bold */
            color: #333333;
            margin-bottom: 5px;
        }

        .calculator-header p {
            font-size: 16px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
            margin: 0;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 25px;
            padding: 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
        }

        /* Normal input styling (unchanged) */
        .input-group input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            font-weight: 400;
            border: 1px solid #d3d3d3;
            border-radius: 6px;
            outline: none;
            box-sizing: border-box;
        }

        /* Only applies at 320px or smaller */
        @media (max-width: 320px) {
            .input-group input {
                font-size: 12px;
            }

            .input-group input::placeholder {
                font-size: 12px;
            }
        }

        /* Results Section */
        .results-section {
            margin-top: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .result-item {
            width: 48%;
            margin-bottom: 25px;
            text-align: center;
        }

        .result-item h3 {
            font-size: 18px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
            margin-bottom: 10px;
        }

        /* Gauge Styling */
        .gauge {
            width: 195px;
            height: 195px;
            position: relative;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .gauge__background {
            stroke: #EFEFEF;
            stroke-width: 10;
            fill: none;
        }

        .gauge__fill {
            stroke-linecap: round;
            stroke-width: 10;
            fill: none;
            transition: stroke-dashoffset 1s ease-out, stroke 0.5s ease;
        }

        /* Financial Metrics */
        .financial-metrics {
            width: 100%;
            margin-top: 20px;
        }

        .financial-item {
            margin-bottom: 15px;
            text-align: center;
        }

        .financial-item h3 {
            font-size: 18px;
            font-weight: 300;
            color: #6B7D8D;
            margin-bottom: 5px;
        }

        .financial-item p {
            font-size: 20px;
            font-weight: 700;
            color: #173248;
            margin: 0;
            transition: color 0.3s ease;
        }

        .financial-item p.red {
            color: #ED5C5C;
        }

        .financial-item p.green {
            color: #75BB7D;
        }

        .financial-item p.black {
            color: #000000; /* New class for black color */
        }

        /* Footer Styling */
        .calculator-footer {
            text-align: center;
            margin-top: 25px;
            font-size: 14px;
            color: #777777;
        }

        /* Liner Note Styling */
        .liner-note {
            text-align: center;
            margin-top: 15px;
            font-size: 12px;
            color: #6B7D8D;
            font-weight: 300;
        }

        .liner-note .footnote {
            margin-top: 10px; /* Adjust the value as needed */
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .result-item {
                width: 100%;
            }

            .gauge {
                width: 250px;
                height: 250px;
            }

            .gauge svg {
                width: 250px;
                height: 250px;
            }

            .gauge text {
                font-size: 40px;
            }

            .financial-item p {
                font-size: 18px;
            }

            /* Added responsive styles for financial-metrics-center */
            .financial-metrics-center {
                flex-direction: column; /* Stacks items vertically on small screens */
            }

            .financial-metrics-center h3.total-additional-profit,
            .financial-metrics-center p.black {
                margin-right: 0; /* Removes right margin when stacked */
            }

            body {
                padding: 10px;
            }
            
            .calculator-container {
                padding: 15px;
                width: 100%;
            }

            .input-group {
                padding: 0;
            }

            .result-item h3 {
                text-align: center; /* Center the titles */
                padding-right: 35px; /* Make room for info icon */
                padding-left: 35px; /* Balance the padding */
                position: relative; /* For absolute positioning of info icon */
            }

            .result-item .info-icon {
                position: absolute;
                right: 5px;
                top: 50%;
                transform: translateY(-50%);
            }
        }

        .logo-container {
            text-align: center;
            margin-top: 20px;  /* Add space above the logo */
        }

        .logo {
            max-width: 250px;  /* Adjust this value to control logo size */
            height: auto;
            display: inline-block;
        }

        /* Responsive styling for the logo */
        @media (max-width: 600px) {
            .logo {
                max-width: 250px;  /* Even smaller on mobile */
            }
        }

        /* Add these new styles */
        .info-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 24px;
            height: 24px;
            background-color: transparent;
            color: #6666CC;
            border: 1px solid #6666CC;
            border-radius: 50%;
            font-size: 12px;
            margin-left: 10px;
            cursor: pointer;
            position: relative;
            font-style: italic;
            vertical-align: middle;
            z-index: 100;
            -webkit-tap-highlight-color: transparent;
            line-height: 1;
            pointer-events: auto;
        }

        .info-icon:hover {
            background-color: #6666CC;
            color: white;
        }

        .tooltip {
            visibility: hidden;
            position: absolute;
            bottom: calc(100% + 10px); /* Add some space between icon and tooltip */
            left: 0;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 12px;
            border-radius: 4px;
            font-size: 14px;
            width: 250px;
            text-align: left;
            z-index: 1000; /* Ensure it's above other elements */
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none; /* Prevents tooltip from interfering with clicks */
        }

        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        /* Add arrow to tooltip */
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        /* Add these styles to your existing CSS */
        .error-message {
            color: #ED5C5C;
            font-size: 14px;
            margin-top: 5px;
            font-weight: 400;
        }

        .input-group input:invalid {
            border-color: #ED5C5C;
        }

        /* Optional: Add a transition for smoother error state changes */
        .input-group input {
            transition: border-color 0.3s ease;
        }

        /* Add these animation styles */
        @keyframes numberChange {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Add animation class */
        .animate-number {
            animation: numberChange 0.5s ease-out;
        }

        /* Update these mobile-specific styles */
        @media (max-width: 768px) {
            /* Remove the fixed positioning */
            html {
                overflow-x: hidden; /* Only prevent horizontal scroll */
                width: 100%;
                height: 100%;
            }
            
            body {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                width: 100%;
                min-height: 100%;
                position: relative; /* Change from absolute to relative */
                margin: 0;
                padding: 10px;
                box-sizing: border-box;
                display: flex;
                justify-content: center;
            }
            
            /* Improve touch targets */
            .input-group input,
            button {
                min-height: 44px;
            }
            
            .input-group {
                margin-bottom: 20px;
            }
            
            input, button {
                font-size: 16px;
            }

            /* Ensure info icons are clickable */
            .info-icon {
                z-index: 1; /* Add this to ensure icons are clickable */
            }

            /* Ensure tooltips appear above other elements */
            .tooltip {
                z-index: 2;
            }

            .tooltip {
                width: 200px;
                left: 0;
                transform: translateX(-50%);
            }

            /* Ensure tooltips don't go off-screen on the right */
            .info-icon:last-child .tooltip {
                left: auto;
                right: 0;
                transform: translateX(0);
            }

            /* Adjust position for right-aligned tooltips */
            .info-icon:last-child .tooltip::after {
                left: auto;
                right: 10px;
            }

            h3 {
                position: relative;
                padding-right: 25px; /* Make room for info icon */
            }
        }

        /* Add install banner styles */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: #6666CC;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            display: none; /* Hidden by default */
        }

        .install-banner.show {
            display: flex;
        }

        /* Add styles for the label wrapper */
        .input-label-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            pointer-events: none;
        }

        .input-label-wrapper label {
            pointer-events: auto;
            margin: 0;
            padding: 0;
            line-height: normal;
        }

        .input-label-wrapper .info-icon {
            pointer-events: auto;
        }

        /* Add specific styles for the Total Labor Spend label */
        #totalLaborCost-label {
            display: flex;
            align-items: center;
            gap: 5px; /* Adds consistent spacing between label and icon */
        }

        /* Add/modify these styles */
        @media (max-width: 600px) {
            .financial-item h3 {
                text-align: center; /* Center the titles */
                padding-right: 35px; /* Increase padding to accommodate the info icon */
                padding-left: 35px; /* Add left padding for balance */
                position: relative; /* For absolute positioning of info icon */
            }

            .financial-item .info-icon {
                position: absolute;
                right: 5px;
                top: 50%;
                transform: translateY(-50%);
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .form-group input:focus {
            border-color: #6666CC;
            outline: none;
        }

        .submit-btn {
            width: 100%;
            background-color: #6666CC;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .submit-btn:hover {
            background-color: #5555BB;
        }

    </style>
</head>
<body>

<div class="calculator-container" role="main">
    <div class="calculator-header" role="banner">
        <h2>Profitability Loss Calculator</h2>
        <p>Measure the true cost of disengagement and turnover on your bottom line.</p>
    </div>

    <div class="input-section" role="form" aria-label="Calculator Inputs">
        <!-- Total Labor Spend Input -->
        <div class="input-group">
            <div class="input-label-wrapper">
                <label for="totalLaborCost">Total Labor Spend (USD)</label>
                <span class="info-icon" role="tooltip" tabindex="0" aria-label="Information about Total Labor Spend">i
                    <span class="tooltip" role="tooltip">The total amount spent annually on employee salaries, wages, and benefits.</span>
                </span>
            </div>
            <input type="text" 
                   id="totalLaborCost" 
                   placeholder="Enter your total labor spend in US dollars"
                   aria-label="Total Labor Spend in USD">
        </div>

        <!-- Estimated Employee Engagement Input -->
        <div class="input-group">
            <label for="employeeEngagement">
                Estimated Employee Engagement (%)
                <span class="info-icon">i
                    <span class="tooltip">According to Gallup, the annual employee engagement for the US is 33%, Global is 23%, and Best-Practice Organizations is 70%.</span>
                </span>
            </label>
            <input type="number" id="employeeEngagement" placeholder="Enter estimated employee engagement" min="0" max="100">
        </div>

        <!-- Projected Turnover Percentage Input -->
        <div class="input-group">
            <label for="turnoverPercentage">
                Projected Turnover Percentage (%)
                <span class="info-icon">i
                    <span class="tooltip">The expected percentage of employees who will leave the organization within the next year.</span>
                </span>
            </label>
            <input type="number" id="turnoverPercentage" placeholder="Enter projected turnover percentage" min="0" max="100">
        </div>
    </div>

    <div class="results-section">
        <!-- Overall Engagement Gauge -->
        <div class="result-item">
            <h3>
                Overall Engagement
                <span class="info-icon">i
                    <span class="tooltip">This reflects the extent to which the organization meets the emotional, intellectual, and practical needs of its employees, ensuring they are supported, valued, and aligned with the organization’s goals. Addressing these needs directly drives their investment and motivation to contribute to success.</span>
                </span>
            </h3>
            <div class="gauge">
                <svg width="195" height="195" viewBox="0 0 195 195">
                    <!-- Background Arc -->
                    <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                    <!-- Fill Arc -->
                    <path class="gauge__fill" id="engagementFill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                          stroke="#ED5C5C" stroke-dasharray="367.566" stroke-dashoffset="367.566" />
                    <!-- Percentage Text -->
                    <text x="97.5" y="115" text-anchor="middle" font-size="31px" font-weight="700"
                          fill="#173248" id="engagementText">0%</text>
                </svg>
            </div>
        </div>

        <!-- Return-On-Labor® Gauge -->
        <div class="result-item">
            <h3>
                Return-On-Labor®
                <span class="info-icon">i
                    <span class="tooltip">This calculates the financial efficiency of labor by balancing employee engagement levels with their contributions to business outcomes.</span>
                </span>
            </h3>
            <div class="gauge">
                <svg width="195" height="195" viewBox="0 0 195 195">
                    <!-- Background Arc -->
                    <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                    <!-- Fill Arc -->
                    <path class="gauge__fill" id="returnOnLaborFill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                          stroke="#E1D687" stroke-dasharray="367.566" stroke-dashoffset="367.566" />
                    <!-- Percentage Text -->
                    <text x="97.5" y="115" text-anchor="middle" font-size="31px" font-weight="700"
                          fill="#173248" id="returnOnLaborText">0%</text>
                </svg>
            </div>
        </div>
    </div>

    <div class="financial-metrics">
        <!-- A 1% Engagement Shift in Engagement is worth -->
        <div class="financial-item">
            <h3>
                A 1% Shift in Engagement is worth
                <span class="info-icon">i
                    <span class="tooltip">The financial and operational impact of improving overall employee engagement by just 1%. This demonstrates how even small changes in engagement can significantly affect productivity, retention, and organizational profitability.</span>
                </span>
            </h3>
            <p class="green" id="onePercentChange">--</p>
        </div>

        <!-- Annualized Lost Labor -->
        <div class="financial-item">
            <h3>
                Annualized Lost Labor
                <span class="info-icon">i
                    <span class="tooltip">The annual cost of underutilized potential within the workforce, calculated based on the gap between employees’ contributions and the organization’s investment in labor.</span>
                </span>
            </h3>
            <p class="red" id="lostLaborCost">--</p>
        </div>

        <!-- Annualized Total Losses with Turnover -->
        <div class="financial-item">
            <h3>
                Annualized Total Losses with Turnover
                <span class="info-icon">i
                    <span class="tooltip">It represents the full annual cost to profitability, combining lost productivity from disengagement with the additional expenses and disruptions caused by workforce turnover.</span>
                </span>
            </h3>
            <p class="red" id="totalAnnualizedLosses">--</p>
        </div>
    </div>

    <!-- Add Generate Report Button Here -->
    <div style="text-align: center; margin: 30px 0;">
        <button id="generateReportBtn" style="background-color: #6666CC; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">
            Generate Profitability Analysis
        </button>
    </div>

    <div class="logo-container">
        <img src="https://static.showit.co/file/JNQ0xT5W_YRPIk_uSDJ7-Q/176740/3.png" alt="Company Logo" class="logo">
    </div>

    <div class="calculator-footer">
        <p>&copy; 2024 The Culture MRI®. All Rights Reserved.</p>
    </div>

    <div class="liner-note">
        <em>*For simplicity, headcount is estimated using national average salary figures.</em>
    </div>
</div>

<!-- Add this modal HTML -->
<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 style="text-align: center; color: #333; margin-bottom: 20px;">Generate Your Profitability Analysis</h3>
        <form id="reportForm">
            <div class="form-group">
                <input type="text" id="firstName" placeholder="First Name" required>
            </div>
            <div class="form-group">
                <input type="text" id="lastName" placeholder="Last Name" required>
            </div>
            <div class="form-group">
                <input type="text" id="company" placeholder="Company" required>
            </div>
            <div class="form-group">
                <input type="email" id="email" placeholder="Email Address" required>
            </div>
            <button type="submit" class="submit-btn">Generate Report</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const params = new URLSearchParams(window.location.search)
        const ref = params.get('ref') ?? ''

        const inputLaborCost = document.getElementById('totalLaborCost');
        const inputEngagement = document.getElementById('employeeEngagement');
        const inputTurnover = document.getElementById('turnoverPercentage');

        const engagementFill = document.getElementById('engagementFill');
        const engagementText = document.getElementById('engagementText');

        const returnOnLaborFill = document.getElementById('returnOnLaborFill');
        const returnOnLaborText = document.getElementById('returnOnLaborText');

        const lostLaborCostEl = document.getElementById('lostLaborCost');
        const onePercentChangeEl = document.getElementById('onePercentChange');
        const totalAnnualizedLossesEl = document.getElementById('totalAnnualizedLosses');

        

        // Initialize gauges and displays
        calculateMetrics();

        // Add event listeners for input fields
        inputLaborCost.addEventListener('input', function(e) {
            // Remove any existing '$', commas, and non-digits except decimal point
            let value = e.target.value.replace(/[$,]/g, '').replace(/[^\d.]/g, '');
            
            // If there's a value, format it
            if (value) {
                // Format with commas and add dollar sign
                e.target.value = '$' + formatNumberWithCommas(value);
            } else {
                // If empty, don't add the dollar sign
                e.target.value = '';
            }
            calculateMetrics();
        });

        // Add validation function
        function validatePercentageInput(input) {
            const value = parseFloat(input.value);
            const inputGroup = input.closest('.input-group');
            
            // Clear any existing error messages
            const existingError = inputGroup.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Validate the input
            if (isNaN(value) || value < 0 || value > 100) {
                input.setCustomValidity('Please enter a value between 0 and 100');
                input.reportValidity();
                
                // Add error message below input
                const errorMessage = document.createElement('div');
                errorMessage.className = 'error-message';
                errorMessage.textContent = 'Please enter a value between 0 and 100';
                inputGroup.appendChild(errorMessage);
                
                return false;
            }
            
            input.setCustomValidity('');
            return true;
        }

        // Update the event listeners
        inputEngagement.addEventListener('input', function() {
            if (validatePercentageInput(this)) {
                calculateMetrics();
            }
        });

        inputTurnover.addEventListener('input', function() {
            if (validatePercentageInput(this)) {
                calculateMetrics();
            }
        });

        function formatNumberWithCommas(number) {
            if (!number) return '';
            const parts = number.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }

        function updateGauge(fillElement, percentage, color) {
            // Ensure percentage does not exceed 100%
            const cappedPercentage = Math.min(Math.max(percentage, 0), 100);
            const dashArray = 367.566; // For radius 78
            const dashOffset = dashArray - (cappedPercentage / 100) * dashArray;

            fillElement.style.strokeDasharray = dashArray;
            fillElement.style.strokeDashoffset = dashOffset;
            fillElement.style.stroke = color;
        }

        function calculateMetrics() {
            // Parse the labor cost input by removing '$' and commas
            const laborCost = parseFloat(inputLaborCost.value.replace(/[$,]/g, ''));
            const engagementPercentage = parseFloat(inputEngagement.value);
            const turnoverPercentage = parseFloat(inputTurnover.value);

            // Constants
            const averageSalary = 60000; // Assumed average salary
            const costToReplaceOneEmployee = 9861; // Given average replacement cost

            if (
                isNaN(laborCost) || laborCost <= 0 ||
                isNaN(engagementPercentage) || engagementPercentage < 0 || engagementPercentage > 100 ||
                isNaN(turnoverPercentage) || turnoverPercentage < 0 || turnoverPercentage > 100
            ) {
                resetGauges();
                return;
            }

            /*** Update Overall Engagement Gauge ***/
            let engagementColor = '';

            if (engagementPercentage <= 50) {
                engagementColor = '#ED5C5C'; // Red
            } else if (engagementPercentage <= 84) {
                engagementColor = '#E1D687'; // Yellow
            } else {
                engagementColor = '#75BB7D'; // Green
            }

            updateGauge(engagementFill, engagementPercentage, engagementColor);
            engagementText.textContent = Math.round(engagementPercentage) + '%'; // Rounded

            /*** Calculate Return-On-Labor® ***/
            const engagementFactor = (0.46 * (engagementPercentage / 100)) + 0.54;
            const returnOnLabor = engagementFactor * laborCost;
            const returnOnLaborPercentage = Math.round( (returnOnLabor / laborCost) * 100 ); // Rounded

            let returnOnLaborColor = '';

            if (returnOnLaborPercentage <= 50) {
                returnOnLaborColor = '#ED5C5C'; // Red
            } else if (returnOnLaborPercentage <= 84) {
                returnOnLaborColor = '#E1D687'; // Yellow
            } else {
                returnOnLaborColor = '#75BB7D'; // Green
            }

            updateGauge(returnOnLaborFill, returnOnLaborPercentage, returnOnLaborColor);
            returnOnLaborText.textContent = Math.round(returnOnLaborPercentage) + '%'; // Rounded

            /*** Update Financial Metrics ***/
            const lostLaborCost = laborCost - returnOnLabor;
            const formattedLostLaborCost = `-$${Math.round(lostLaborCost).toLocaleString('en-US')}`; // Rounded
            lostLaborCostEl.textContent = formattedLostLaborCost;

            const onePercentChange = Math.round(0.0046 * laborCost); // Rounded
            const formattedOnePercentChange = `$${onePercentChange.toLocaleString('en-US')}`;
            onePercentChangeEl.textContent = formattedOnePercentChange;

            /*** Calculate Projected Turnover Costs ***/
            // Estimate headcount
            const estimatedHeadcount = laborCost / averageSalary;

            // Convert turnover percentage to decimal
            const turnoverDecimal = turnoverPercentage / 100;

            // Projected Turnover Costs
            const projectedTurnoverCosts = estimatedHeadcount * turnoverDecimal * costToReplaceOneEmployee;

            /*** Calculate Total Annualized Losses ***/
            const totalAnnualizedLosses = lostLaborCost + projectedTurnoverCosts;
            const formattedTotalAnnualizedLosses = `-$${Math.round(totalAnnualizedLosses).toLocaleString('en-US')}`; // Rounded
            totalAnnualizedLossesEl.textContent = formattedTotalAnnualizedLosses;
        }

        function resetGauges() {
            // Reset Overall Engagement gauge to 0%
            updateGauge(engagementFill, 0, '#ED5C5C');
            engagementText.textContent = '0%';

            // Reset Return-On-Labor® gauge to 0%
            updateGauge(returnOnLaborFill, 0, '#E1D687');
            returnOnLaborText.textContent = '0%';

            // Reset financial metrics to '--'
            lostLaborCostEl.textContent = '--';
            onePercentChangeEl.textContent = '--';
            totalAnnualizedLossesEl.textContent = '--';
        }

        // Add keyboard support for tooltips
        const infoIcons = document.querySelectorAll('.info-icon');
        infoIcons.forEach(icon => {
            icon.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const tooltip = this.querySelector('.tooltip');
                    tooltip.style.visibility = 'visible';
                    tooltip.style.opacity = '1';
                }
            });
            
            icon.addEventListener('blur', function() {
                const tooltip = this.querySelector('.tooltip');
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            });
        });

        // Add this to your existing JavaScript
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Add install prompt handling
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button or banner
            showInstallPromotion();
        });

        // Add this to your existing DOMContentLoaded event listener
        function setupTooltips() {
            const infoIcons = document.querySelectorAll('.info-icon');
            let activeTooltip = null;

            function closeActiveTooltip() {
                if (activeTooltip) {
                    activeTooltip.querySelector('.tooltip').style.visibility = 'hidden';
                    activeTooltip.querySelector('.tooltip').style.opacity = '0';
                    activeTooltip = null;
                }
            }

            infoIcons.forEach(icon => {
                icon.addEventListener('touchstart', function(e) {
                    e.preventDefault(); // Prevent default touch behavior
                    e.stopPropagation(); // Stop event from bubbling
                    
                    const tooltip = this.querySelector('.tooltip');
                    
                    if (activeTooltip === this) {
                        closeActiveTooltip();
                        return;
                    }
                    
                    closeActiveTooltip();
                    
                    tooltip.style.visibility = 'visible';
                    tooltip.style.opacity = '1';
                    activeTooltip = this;
                });

                icon.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    // ... rest of click handling
                });
            });

            // Close tooltip when touching anywhere else
            document.addEventListener('touchstart', function(e) {
                if (!e.target.closest('.info-icon')) {
                    closeActiveTooltip();
                }
            });

            // Keep existing click and keyboard handlers
            // ... rest of the setupTooltips function
        }

        setupTooltips();

        // Add to your existing JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('reportModal');
            const generateBtn = document.getElementById('generateReportBtn');
            const closeBtn = document.querySelector('.close-modal');
            const reportForm = document.getElementById('reportForm');

            // Open modal
            generateBtn.addEventListener('click', function() {
                modal.style.display = 'block';
            });

            // Close modal
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Handle form submission
            reportForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    company: document.getElementById('company').value,
                    email: document.getElementById('email').value
                };

                console.log('Form submitted:', formData);
                // Here we'll add the code to send to Google Sheets
                
                modal.style.display = 'none';
                alert('Thank you! Your report will be sent to your email shortly.');
            });
        });
    });

    function showInstallPromotion() {
        const banner = document.createElement('div');
        banner.className = 'install-banner';
        banner.innerHTML = `
            <div>Install this app on your device for easy access</div>
            <button id="installBtn">Install</button>
            <button id="closeInstallBtn">✕</button>
        `;
        document.body.appendChild(banner);
        
        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                banner.remove();
            }
        });
        
        document.getElementById('closeInstallBtn').addEventListener('click', () => {
            banner.remove();
        });
    }
</script>

</body>
</html>
